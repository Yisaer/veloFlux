#!/usr/bin/env bash
set -euo pipefail
profile="release"
args=("$@")
filtered_args=()
level_specified="false"
while [[ $# -gt 0 ]]; do
  case "$1" in
    patch|minor|major)
      level_specified="true"
      shift ;;
    --profile)
      if [[ $# -ge 2 ]]; then
        profile="$2"
        shift 2
      else
        echo "[cargo-release shim] missing value for --profile" >&2
        exit 1
      fi ;;
    --workspace|--no-tag|--no-push|--skip-publish|--no-confirm|--dry-run|--locked)
      shift ;;
    *)
      shift ;;
  esac
done
if [[ "$level_specified" == "false" ]]; then
  echo "[cargo-release shim] release level not specified; defaulting to patch"
fi
if [[ -z "$profile" ]]; then
  profile="release"
fi
if [[ "$profile" != "release" ]]; then
  echo "[cargo-release shim] building profile "
else
  echo "[cargo-release shim] building profile release"
fi
cargo build --profile "$profile" --locked
